buildscript {

  repositories {
    google()
    jcenter()
    mavenCentral()

  }
  dependencies {
    classpath 'org.jetbrains.kotlin:kotlin-gradle-plugin:1.1.4-3'
    classpath 'org.jetbrains.kotlin:kotlin-allopen:1.1.4-3'
    classpath 'com.vanniktech:gradle-android-junit-jacoco-plugin:0.11.0'
  }
}

evaluationDependsOn(':plexapp-rest-library')
evaluationDependsOn(':subtitle-converter')

repositories {
  google()
  jcenter()
  mavenCentral()
  maven {
    url "http://kingargyle.github.io/repo"
  }
}

apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-kapt'
apply plugin: "kotlin-allopen"
apply plugin: 'com.vanniktech.android.junit.jacoco'
apply plugin: 'org.sonarqube'

sonarqube {
  properties {
    property "sonar.host.url", "https://sonarcloud.io"
    property "sonar.organization", "kingargyle-github"
    property "sonar.login", "cb7af08f0b0e86306ac5365074326dc27aba503e"
    property "sonar.jacoco.reportPath", "${project.buildDir}/jacoco/testDebugUnitTest.exec"
    property "sonar.coverage.exclusions", "**/*_ViewBinding.class, **/*InjectAdapter.class, android/support/**/*.class,\
              com/google/**/*.class, com/birbit/**/*.class, butterknife/**/*.class, \
              com/arellomobile/**/*.class, net/ganin/darv/**/*.class, **/*ViewStateProvider.class,\
              **/*PresentersBinder.class, us/nineworlds/serenity/R.*.class"
  }
}

allOpen {
  annotation("us.nineworlds.serenity.common.annotations.OpenForTesting")
}

android {
  defaultConfig {
    versionCode 2000002
    versionName "2.0.0-M4"

    minSdkVersion 17
    targetSdkVersion 27
    multiDexEnabled true

  }

  aaptOptions {
    cruncherEnabled false
  }

  sourceSets {
    main.java.srcDirs += 'src/main/kotlin'
    test.java.srcDirs += 'src/test/kotlin'
  }


  compileSdkVersion 27
  buildToolsVersion '27.0.1'

  if (project.hasProperty("keystore")) {
    signingConfigs {
      release {
        storeFile file(project.property("keystore"))
        storePassword project.property("storepass")
        keyAlias project.property("keyalias")
        keyPassword project.property("keypass")
      }
    }
  }

  targetCompatibility = '1.7'
  sourceCompatibility = '1.7'

  buildTypes {
    debug {
      minifyEnabled false
    }
    release {
      if (project.hasProperty("keystore")) {
        signingConfig signingConfigs.release
      }
      zipAlignEnabled true
      minifyEnabled false
    }
  }

  lintOptions {
    checkReleaseBuilds false
    // Or, if you prefer, you can continue to check for errors in release builds,
    // but continue the build even when errors are found:
    abortOnError false
  }

  testOptions {
    unitTests.returnDefaultValues = true
    unitTests.includeAndroidResources = true
    unitTests.all {
      minHeapSize = "512m"
      maxHeapSize = "1024m"
    }
  }

  compileOptions {
    incremental = false
  }

}

junitJacoco {
  jacocoVersion = '0.7.2.201409121644' // type String
  excludes = ["**/*_ViewBinding.class", "**/*InjectAdapter.class", "android/support/**/*.class",
              "com/google/**/*.class", "com/birbit/**/*.class", "butterknife/**/*.class",
              "com/arellomobile/**/*.class", "net/ganin/darv/**/*.class", "**/*ViewStateProvider.class",
              "**/*PresentersBinder.class",
              "us/nineworlds/serenity/R.*.class"]
}

dependencies {

  implementation group: 'com.github.bumptech.glide', name: 'okhttp3-integration', version: '1.5.0'

  implementation project(':plexapp-rest-library')
  implementation project(':subtitle-converter')
  implementation project(':emby-lib')
  implementation project(':serenity-android-common')

  implementation ('com.google.android.exoplayer:exoplayer-core:r2.5.1') {
    exclude module: 'support-annotations'
  }
  implementation ('com.google.android.exoplayer:exoplayer-ui:r2.5.1') {
    exclude module: 'support-annotations'
  }

  implementation ('com.google.android.exoplayer:extension-okhttp:r2.5.1') {
    exclude module: 'support-annotations'
  }

  implementation('com.squareup.okhttp3:okhttp:3.6.0') {
    exclude group: 'com.android.support'
  }

  implementation 'com.android.support:multidex:1.0.2'
  implementation 'org.jetbrains.kotlin:kotlin-stdlib-jre7:1.1.4-3'
  implementation 'com.arello-mobile:moxy:1.5.3'
  implementation 'com.arello-mobile:moxy-app-compat:1.5.3'
  implementation 'com.github.bumptech.glide:glide:3.8.0'
  implementation 'org.greenrobot:eventbus:3.0.0'
  implementation 'com.birbit:android-priority-jobqueue:2.0.1'
  implementation 'com.google.android.gms:play-services-analytics-impl:11.8.0'
  implementation 'com.android.support:appcompat-v7:27.0.2'
  implementation 'com.android.support:leanback-v17:27.0.2'
  implementation 'com.android.support:support-v4:27.0.2'
  implementation 'com.googlecode.juniversalchardet:juniversalchardet:1.0.3'
  implementation 'com.mcxiaoke.volley:library:1.0.6'
  implementation 'com.squareup.okhttp3:okhttp-urlconnection:3.6.0'
  implementation 'com.squareup.dagger:dagger:1.2.2'
  implementation 'com.github.vganin:dpadaware-recyclerview:1.0.1'
  implementation 'com.jakewharton:butterknife:8.8.1'
  implementation 'com.jakewharton.timber:timber:4.6.0'

  testImplementation 'org.apache.commons:commons-lang3:3.3.2'
  testImplementation('org.robolectric:robolectric:3.5.1') {
    exclude module: 'support-v4'
  }
  testImplementation('com.squareup.assertj:assertj-android:1.1.1') {
    exclude module: 'support-v4'
    exclude module: 'support-annotations'
  }

  testImplementation 'org.assertj:assertj-core:3.8.0'
  testImplementation 'junit:junit:4.12'
  testImplementation 'org.robolectric:shadows-framework:3.5.1'
  testImplementation 'org.robolectric:shadows-httpclient:3.5.1'
  testImplementation 'org.robolectric:shadows-supportv4:3.5.1'
  testImplementation 'org.robolectric:shadows-playservices:3.5.1'
  testImplementation 'org.robolectric:shadows-multidex:3.5.1'
  testImplementation 'org.khronos:opengl-api:gl1.1-android-2.1_r1'
  testImplementation 'org.mockito:mockito-core:2.12.0'

  testImplementation 'com.squareup.okhttp3:mockwebserver:3.8.1'
  testImplementation 'commons-io:commons-io:2.4'

  kapt 'com.arello-mobile:moxy-compiler:1.5.3'
  kapt 'com.squareup.dagger:dagger-compiler:1.2.2'
  kapt 'com.jakewharton:butterknife-compiler:8.8.1'
  kaptTest 'com.squareup.dagger:dagger-compiler:1.2.2'
}
